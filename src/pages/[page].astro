---
import { render } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";
import Prose from "../components/Prose.astro";
import { getCollectionOrderByDate, getWordCount } from "../utils/utils";

export const getStaticPaths = async () => {
  const blogs = await getCollectionOrderByDate("blog",({data})=>{
    return data.published === true;
  });
  return blogs.map((item) => ({
    params: {
      page: item.data.title,
    },
    props: {
      title: item.data.title,
      description: item.data.description,
      date: item.data.date,
      fontNum: getWordCount(item.body ? item.body : ""),
      Content: item,
    },
  }));
};

const { title, description, date, fontNum, Content: rawContent } = Astro.props;
const { Content } = await render(rawContent);
const MIN_READ_COUNT = 350;
const readTimeMin = Math.ceil(fontNum / MIN_READ_COUNT);
console.log(fontNum);
---

<BaseLayout>
  <div class="blog-head">
    <h1 class="title">{title}</h1>
    <p class="description">{description}</p>
    <div class="other-info">
      <p class="date"><em>{date}</em></p>
      <p class="read-time"><em>{readTimeMin}</em> 分钟 阅读</p>
    </div>
  </div>

  <Prose>
    <Content />
  </Prose>
</BaseLayout>

<style is:global>
  * {
    box-sizing: border-box; /* 确保所有元素的宽高包含 padding 和 border */
  }
  html {
    scrollbar-gutter: stable; /* 防止滚动条导致页面宽度不一致 */
  }
  html body {
    margin: 0;
    padding: 0;
    height: 100%; /* 确保body和html占满全屏 */
    margin: 0;
  }

  em {
    font-style: normal;
  }

  .blog-head {
    padding-bottom: 50px;
  }

  .blog-head > * {
    line-height: 50px;
  }

  .other-info > * {
    line-height: 20px;
  }

  .title {
    font-size: 2rem;
  }

  .description {
    font-weight: lighter;
    font-size: 1.3rem;
  }
  .other-info {
    font-size: 0.9rem;
  }

  .blog-head .description {
    color: #808080;
  }

  .blog-head .other-info p {
    color: #808080;
  }
</style>
